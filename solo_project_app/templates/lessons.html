{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AbuAlia ICT</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static 'solo_project_app/lesson.css' %}">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container-fluid ">
            <img id="logo" src="{% static 'images/channels4_profile.jpg' %}" alt="Trading Academy">
            <h1>Welcome {{user.first_name}}!</h1>

            <div>
                <div id="navbarSupportedContent">
                    <a class="login-link" href="{% url 'dashboard' %}"><button id="login-btn">Dashboard</button></a>
                    <a class="login-link" href="{% url 'logout' %}"><button id="login-btn">Log Out</button></a>
                </div>
            </div>
        </div>
    </nav>
    <div class="search">
        <h2>Search Lessons</h2>
        <input type="text" id="lesson-search" placeholder="Type lesson name..." class="form-control"
            style="width: 400px; margin-bottom: 20px;">
        <div id="search-results">
        
        </div>
        <div id="search-result">
            {% for course in Courses %}
            <div class="course-card">
                <h3>{{course.title}}</h3>
                <p>{{course.description}}</p>
            </div>
            {% endfor %}
        </div>
    </div>
    </div>
    <main>
        <div class="left">
            {% if purchased_courses %}
            {% for course in purchased_courses %}
            <div class="courses">
                <h1 id="title">Course Name : {{ course.title }} </h1>
                <div class="course-1">
                    {% for lesson in course.lessons.all %}
                    <h2 id="l-title">{{ lesson.order }}. {{ lesson.title }}</h2>
                    <iframe src="https://www.youtube.com/embed/{{ lesson.video_url}}" frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowfullscreen>></iframe>
                    {% empty %}
                    <p>No lessons availaple for this course yet</p>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
            {% else %}
            <p>You haven't purchased any courses yet.</p>
            {% endif %}
        </div>

    </main>

    <script>
        const lessonInput = document.getElementById('lesson-search');
        const lessonResults = document.getElementById('search-results');
        const searchUrl = "{% url 'search_lessons' %}";  // Use Django url template

        lessonInput.addEventListener('keyup', function () {
            const query = this.value.trim();
            if (!query) {
                lessonResults.innerHTML = "";  // Clear results if empty
                return;
            }

            fetch(`${searchUrl}?q=${encodeURIComponent(query)}`)
                .then(res => res.json())
                .then(data => {
                    lessonResults.innerHTML = '';
                    if (!data.lessons.length) {
                        lessonResults.innerHTML = '<p>No lessons found.</p>';
                        return;
                    }
                    data.lessons.forEach(lesson => {
                        const div = document.createElement('div');
                        div.classList.add('lesson-card');
                        div.innerHTML = `
                    <h4>${lesson.title}</h4>
                    <p>${lesson.description || ''}</p>
                    <a href="/view_course/${lesson.course_id}/lesson/${lesson.id}/">View Lesson</a>

                `;
                        lessonResults.appendChild(div);
                    });
                })
                .catch(err => console.error('Error fetching lessons:', err));
        });
    </script>


</body>

</html>